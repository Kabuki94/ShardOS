# .github/workflows/build.yml (use the ref in the job: a9d8a3243a7e16611cbd4dbb2ba1e28b840808ab)
- name: Determine build options for signing (force no-sign)
  id: set_build_opts
  shell: bash
  run: |
    # keep the output but do not rely on it as the single source of truth
    echo "build_opts=--no-sign" >> "$GITHUB_OUTPUT"

- name: Build Custom Image
  uses: blue-build/github-action@v1.10.2
  with:
    recipe: ${{ matrix.recipe }}
    build_opts: '--no-sign'                   # <-- explicit literal
    registry_token: ${{ github.token }}
    pr_event_number: ${{ github.event.number }}
  env:
    BUILD_OPTS: '--no-sign'                    # <-- explicit literal

- name: Debug build options
  shell: bash
  run: |
    echo "Resolved build_opts='${{ steps.set_build_opts.outputs.build_opts }}'"
    echo "ENV BUILD_OPTS='${BUILD_OPTS:-}'"
    bluebuild --version || true
  env:
    BUILD_OPTS: '--no-sign'

- name: Build image (explicitly skip signing)
  shell: bash
  run: |
    bluebuild build --no-sign
  env:
    BUILD_OPTS: '--no-sign'

- name: Push image (explicitly skip signing)
  shell: bash
  run: |
    bluebuild push --no-sign
  env:
    BUILD_OPTS: '--no-sign'
